<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlanPilot</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- PlanPilot CSS -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/map.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
    <!-- Hamburger Menu Button -->
    <button class="hamburger-menu" id="hamburgerBtn" onclick="toggleSidebar()" aria-label="Toggle menu">
        <span></span>
        <span></span>
        <span></span>
    </button>
    
    <!-- Sidebar Backdrop for Mobile -->
    <div class="sidebar-backdrop" id="sidebarBackdrop" onclick="closeSidebar()"></div>
    
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-fixed-header">
            <div class="sidebar-header">
                <div class="sidebar-header-logo" id="logoContainer">
                    <img id="logoImage" src="planpilot.png" alt="PlanPilot Logo" onerror="showLogoFallback()">
                </div>
                <h1>
                    <span>PlanPilot</span>
                    <button class="info-btn" onclick="openInfoModal()" title="About PlanPilot">i</button>
                </h1>
                <p>Plan your perfect getaway</p>
            </div>
            
            <div class="sidebar-action-buttons">
                <button class="btn btn-primary" onclick="openPlanningModal()" style="margin-bottom: 10px;">
                    üöÄ Start Planning
                </button>
                
                <button class="btn btn-secondary" onclick="toggleTripSummary()" style="margin-bottom: 15px;">
                    üìã Trip Itinerary
                </button>

                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-secondary" onclick="exportData()" style="flex: 1;">üíæ Save</button>
                    <button class="btn btn-secondary" onclick="importData()" style="flex: 1;">üìÇ Load</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Map Container -->
    <div id="map"></div>

    <!-- Trip Summary Panel -->
    <div id="trip-summary-container" class="trip-summary-container">
        <div class="trip-summary-header">
            <h3><span id="tripTitleDisplay">üó∫Ô∏è Trip Itinerary</span></h3>
            <div class="trip-summary-header-actions">
                <button id="trip-summary-edit-btn" class="trip-summary-edit-btn" onclick="toggleEditMode()" title="Add Location">
                    <span id="editModeIcon">+</span>
                </button>
                <button id="trip-summary-delete-btn" class="trip-summary-edit-btn" onclick="toggleDeleteMode()" title="Delete Mode">
                    <span id="deleteModeIcon">üóëÔ∏è</span>
                </button>
                <button id="trip-summary-close" class="trip-summary-close" onclick="toggleTripSummary()">‚úï</button>
            </div>
        </div>
        <div id="editTripContainer" class="trip-summary-edit-container" style="display: none;">
            <div class="control-group">
                <label for="tripTitle">Trip Title</label>
                <input type="text" id="tripTitle" placeholder="e.g., Sri Lanka Honeymoon" oninput="updateTripTitle()">
                <small>This title will display in the header above</small>
            </div>

            <div id="connectionMode" class="connection-mode" style="display: none;">
                <p><strong>Connection Mode Active</strong><br>Click on two Key Locations to connect them with a line.</p>
                <button class="btn btn-secondary" onclick="cancelConnectionMode()">Cancel</button>
            </div>

            <div class="control-group">
                <label for="locationType">Location Type</label>
                <select id="locationType">
                    <option value="key-location">Key Location</option>
                    <option value="accommodation">Accommodation</option>
                    <option value="attraction">Attraction</option>
                </select>
            </div>

            <div class="control-group">
                <label for="locationName">Name</label>
                <input type="text" id="locationName" placeholder="e.g., Eiffel Tower">
            </div>

            <div class="control-group">
                <label for="locationDescription">Description (Optional)</label>
                <textarea id="locationDescription" placeholder="Add notes about this location..."></textarea>
            </div>

            <div class="control-group">
                <label for="locationPrice">Price (Optional)</label>
                <input type="text" id="locationPrice" placeholder="e.g., $150/night or ‚Ç¨25 entry">
            </div>

            <div class="control-group">
                <label for="locationLink">Link (Optional)</label>
                <input type="url" id="locationLink" placeholder="https://example.com/booking">
                <small>Website, booking link, or reference URL</small>
            </div>

            <div class="control-group">
                <label for="locationCoords">Coordinates</label>
                <input type="text" id="locationCoords" placeholder="Click on map or enter lat, lng" readonly>
                <small>Click anywhere on the map to set coordinates</small>
            </div>

            <div class="trip-summary-edit-actions">
                <button class="btn btn-primary" onclick="addLocation()">Add to Map</button>
                <button class="btn btn-secondary" onclick="startConnectionMode()">Connect Key Locations</button>
            </div>
        </div>
        <div class="trip-summary-body">
            <!-- Content generated dynamically by trip-summary.js -->
        </div>
    </div>

    <!-- Map Controls Toggle Button -->
    <button id="map-controls-toggle-btn" class="map-controls-toggle-btn" onclick="toggleMapControls()">
        üó∫Ô∏è Map Controls
    </button>

    <!-- Map Controls Panel -->
    <div id="map-controls-panel" class="map-controls-panel">
        <div class="map-controls-header">
            <h4>üó∫Ô∏è Map Controls</h4>
            <button class="map-controls-close" onclick="toggleMapControls()">‚úï</button>
        </div>
        
        <div class="map-controls-section">
            <h5>Map Style</h5>
            <div class="map-style-options">
                <div class="map-style-option" onclick="changeMapStyle('light')">
                    <input type="radio" name="mapStyle" id="styleLight" value="light" checked>
                    <label for="styleLight">‚òÄÔ∏è Light</label>
                </div>
                <div class="map-style-option" onclick="changeMapStyle('street')">
                    <input type="radio" name="mapStyle" id="styleStreet" value="street">
                    <label for="styleStreet">üó∫Ô∏è Street</label>
                </div>
                <div class="map-style-option" onclick="changeMapStyle('satellite')">
                    <input type="radio" name="mapStyle" id="styleSatellite" value="satellite">
                    <label for="styleSatellite">üõ∞Ô∏è Satellite</label>
                </div>
                <div class="map-style-option" onclick="changeMapStyle('topo')">
                    <input type="radio" name="mapStyle" id="styleTopo" value="topo">
                    <label for="styleTopo">‚õ∞Ô∏è Topographic</label>
                </div>
                <div class="map-style-option" onclick="changeMapStyle('dark')">
                    <input type="radio" name="mapStyle" id="styleDark" value="dark">
                    <label for="styleDark">üåô Dark</label>
                </div>
            </div>
        </div>

        <div class="map-controls-section">
            <h5>üîç Show/Hide Locations</h5>
            <div class="filter-item" onclick="toggleFilter('filterKeyLocation')">
                <input type="checkbox" id="filterKeyLocation" checked onchange="applyFilters()" onclick="event.stopPropagation()">
                <div class="legend-color key-location">üìç</div>
                <label for="filterKeyLocation">
                    <span>Key Locations</span>
                    <span class="filter-item-count" id="countKeyLocation">0</span>
                </label>
            </div>
            <div class="filter-item" onclick="toggleFilter('filterAccommodation')">
                <input type="checkbox" id="filterAccommodation" checked onchange="applyFilters()" onclick="event.stopPropagation()">
                <div class="legend-color accommodation">üè®</div>
                <label for="filterAccommodation">
                    <span>Accommodation</span>
                    <span class="filter-item-count" id="countAccommodation">0</span>
                </label>
            </div>
            <div class="filter-item" onclick="toggleFilter('filterAttraction')">
                <input type="checkbox" id="filterAttraction" checked onchange="applyFilters()" onclick="event.stopPropagation()">
                <div class="legend-color attraction">‚≠ê</div>
                <label for="filterAttraction">
                    <span>Attractions</span>
                    <span class="filter-item-count" id="countAttraction">0</span>
                </label>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div id="importModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìÇ Load Data</h2>
            </div>
            <div class="modal-body">
                <div class="control-group">
                    <label>Option 1: Select JSON File</label>
                    <input type="file" id="importFile" accept=".json" style="margin-bottom: 10px;" onchange="clearImportText()">
                    <small>Choose a .json file from your computer</small>
                </div>
                <div style="text-align: center; margin: 15px 0; color: var(--text-muted);">‚Äî OR ‚Äî</div>
                <div class="control-group">
                    <label for="importText">Option 2: Paste JSON Data</label>
                    <textarea id="importText" style="min-height: 150px;" oninput="clearImportFile()"></textarea>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="processImport()">Load</button>
                <button class="btn btn-secondary" onclick="closeImportModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div id="confirmModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2 id="confirmTitle">‚ö†Ô∏è Confirm Action</h2>
            </div>
            <div class="modal-body">
                <p id="confirmMessage" style="font-size: 14px; color: var(--text-primary); line-height: 1.6;"></p>
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" id="confirmYes">Yes, Continue</button>
                <button class="btn btn-secondary" id="confirmNo">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Alert Modal -->
    <div id="alertModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2 id="alertTitle">‚ÑπÔ∏è Information</h2>
            </div>
            <div class="modal-body">
                <p id="alertMessage" style="font-size: 14px; color: var(--text-primary); line-height: 1.6; white-space: pre-line;"></p>
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" id="alertOk">OK</button>
            </div>
        </div>
    </div>

    <!-- Planning Modal -->
    <div id="planningModal" class="modal">
        <div class="modal-content" style="max-width: 550px;">
            <div class="modal-header">
                <h2>üöÄ Plan Your Trip</h2>
            </div>
            <div class="modal-body">
                <p style="font-size: 14px; color: #555; margin-bottom: 20px;">
                    Tell us about your trip and our AI will research and generate a complete itinerary for you!
                </p>
                
                <form id="tripPlanningForm" onsubmit="handlePlanningFormSubmit(event)">
                    <div class="control-group">
                        <label for="planDestination">Destination *</label>
                        <input type="text" id="planDestination" required placeholder="e.g., Paris, France">
                    </div>
                    
                    <div class="control-group">
                        <label for="planDuration">Trip Duration *</label>
                        <input type="text" id="planDuration" required placeholder="e.g., 5 days, 1 week">
                    </div>
                    
                    <div class="control-group">
                        <label for="planBudget">Budget Level</label>
                        <select id="planBudget">
                            <option value="">Select budget (optional)</option>
                            <option value="budget">Budget-friendly</option>
                            <option value="mid-range">Mid-range</option>
                            <option value="luxury">Luxury</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label for="planResponseMode">AI Response Mode</label>
                        <select id="planResponseMode">
                            <option value="flash">‚ö° Quick & Light (5-15 seconds, fewer options)</option>
                            <option value="pro">üéØ Slow & Detailed (15-30 seconds, more options)</option>
                        </select>
                        <small style="font-style: italic;">
                            Quick mode is faster and cheaper. Detailed mode searches more thoroughly and provides more accommodation and attraction options.
                        </small>
                    </div>
                    
                    <div class="control-group">
                        <label for="planInterests">Interests (comma-separated)</label>
                        <input type="text" id="planInterests" placeholder="e.g., art, food, history, beaches">
                    </div>
                    
                    <div class="control-group">
                        <label for="planMustVisit">Must-Visit Locations</label>
                        <textarea id="planMustVisit" rows="2" placeholder="Specific places you want to include (optional)"></textarea>
                    </div>
                    
                    <div class="note" style="margin-top: 15px; font-size: 12px;">
                        <strong>‚ú® Note:</strong> The AI will research accommodations, attractions, prices, and coordinates to create your complete trip plan.
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button type="submit" form="tripPlanningForm" class="btn btn-primary">
                    ‚ú® Generate Trip Plan
                </button>
                <button class="btn btn-secondary" onclick="closePlanningModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <h3 id="loadingTitle">Generating Your Trip Plan...</h3>
            <p id="loadingMessage">Researching destinations and gathering information</p>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
        </div>
    </div>

    <!-- Info Modal -->
    <div id="infoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üó∫Ô∏è About PlanPilot</h2>
            </div>
            <div class="modal-body">
                <div class="info-content">
                    <h3>What is PlanPilot?</h3>
                    <p>PlanPilot is an AI-powered trip planning application that helps you create, visualize, and manage your travel itineraries on an interactive map. Whether you're planning a weekend getaway or a multi-week adventure, PlanPilot makes trip planning effortless and organized.</p>
                    
                    <h3>Key Features</h3>
                    
                    <h4>ü§ñ AI Trip Generation</h4>
                    <ul>
                        <li>Click <strong>"üöÄ Start Planning"</strong> to use AI to generate complete trip plans</li>
                        <li>Provide your destination, duration, budget level, and interests</li>
                        <li>AI researches and creates a full itinerary with real accommodations, attractions, prices, and booking links</li>
                        <li>Automatic GPS coordinates and map visualization</li>
                        <li>Choose between Quick mode (faster) or Detailed mode (more options)</li>
                    </ul>

                    <h4>üó∫Ô∏è Interactive Map</h4>
                    <ul>
                        <li><strong>Purple markers (üìç)</strong> - Key destinations and cities</li>
                        <li><strong>Green markers (üè®)</strong> - Accommodations with prices and booking links</li>
                        <li><strong>Red markers (‚≠ê)</strong> - Attractions and places to visit</li>
                        <li>Click any marker to view details, prices, and external links</li>
                        <li>Visual connection lines show travel routes between destinations</li>
                        <li>Multiple map styles available (Street, Satellite, Topographic, Dark mode)</li>
                    </ul>

                    <h4>üìã Trip Itinerary View</h4>
                    <ul>
                        <li>Click <strong>"üìã Trip Itinerary"</strong> to see your complete trip timeline</li>
                        <li>View trip statistics: number of stops, total days, accommodations, and attractions</li>
                        <li>Each key location shows nearby accommodations and attractions organized by distance</li>
                        <li>Drag and drop to reorder locations in your itinerary</li>
                        <li>Click any location to pan the map to that spot</li>
                        <li>Delete or modify items directly from the itinerary</li>
                    </ul>

                    <h4>üìç Manual Location Management</h4>
                    <ul>
                        <li>Click anywhere on the map to set coordinates for a new location</li>
                        <li>Use the sidebar form to add custom locations with details</li>
                        <li>Edit location type, name, description, price, and links</li>
                        <li>View and manage all locations in the sidebar list</li>
                        <li>Filter locations by type using the filter buttons</li>
                    </ul>

                    <h4>üîó Connections Between Locations</h4>
                    <ul>
                        <li>Draw lines between key locations to show your travel route</li>
                        <li>Click "Connect Locations" to enter connection mode</li>
                        <li>Click two key locations in sequence to create a connection line</li>
                        <li>Visual route representation on the map</li>
                    </ul>

                    <h4>üíæ Save & Load Trips</h4>
                    <ul>
                        <li><strong>"üíæ Save"</strong> - Export your trip as a JSON file for backup or sharing</li>
                        <li><strong>"üìÇ Load"</strong> - Import saved trips from JSON files or paste JSON data</li>
                        <li>All trips automatically save to your browser's local storage</li>
                        <li>No account required - data persists across sessions</li>
                    </ul>

                    <h3>How to Use PlanPilot</h3>
                    
                    <h4>Option 1: AI-Generated Trip (Easiest)</h4>
                    <ol>
                        <li>Click the <strong>"üöÄ Start Planning"</strong> button</li>
                        <li>Fill out the form:
                            <ul>
                                <li><strong>Destination:</strong> Where you want to go (e.g., "Paris, France")</li>
                                <li><strong>Duration:</strong> How long you'll be there (e.g., "5 days")</li>
                                <li><strong>Budget Level:</strong> Choose Economy, Mid-range, or Luxury</li>
                                <li><strong>Interests:</strong> Select activities you enjoy (culture, food, adventure, etc.)</li>
                                <li><strong>Must-Visit:</strong> Any specific places you want to include (optional)</li>
                            </ul>
                        </li>
                        <li>Choose your generation mode (Quick or Detailed)</li>
                        <li>Click <strong>"Generate Trip Plan"</strong> and wait for AI to create your itinerary</li>
                        <li>Your trip appears on the map with all markers, details, and connections!</li>
                    </ol>

                    <h4>Option 2: Manual Trip Planning</h4>
                    <ol>
                        <li>Click anywhere on the map to set coordinates</li>
                        <li>In the sidebar, select the location type (Key Location, Accommodation, or Attraction)</li>
                        <li>Fill in the name, description, price, and link (optional)</li>
                        <li>Click <strong>"Add Location"</strong> to place it on the map</li>
                        <li>Repeat for all your destinations</li>
                        <li>Use "Connect Locations" to draw routes between key destinations</li>
                    </ol>

                    <h4>Option 3: Import Existing Trip</h4>
                    <ol>
                        <li>Click <strong>"üìÇ Load"</strong></li>
                        <li>Either upload a JSON file or paste JSON data</li>
                        <li>Click <strong>"Import Data"</strong></li>
                        <li>Your trip loads instantly on the map</li>
                    </ol>

                    <h3>Managing Your Trip</h3>
                    <ul>
                        <li><strong>View Details:</strong> Click any marker or location in the sidebar to see full information</li>
                        <li><strong>Edit Trip Title:</strong> Click the title at the top center of the map to rename your trip</li>
                        <li><strong>Filter Locations:</strong> Use the type filter buttons to show/hide specific location types</li>
                        <li><strong>Delete Locations:</strong> Click the delete button next to any location in the sidebar or itinerary</li>
                        <li><strong>Reorder Itinerary:</strong> Open the Trip Itinerary and drag locations to change their order</li>
                        <li><strong>Export for Sharing:</strong> Click "üíæ Save" to download your trip as a shareable file</li>
                        <li><strong>Clear Everything:</strong> Use "Clear All" (bottom of sidebar) to start fresh</li>
                    </ul>

                    <h3>Tips & Tricks</h3>
                    <ul>
                        <li>Use the Trip Itinerary view to get a timeline overview of your entire journey</li>
                        <li>Each accommodation and attraction is automatically associated with its nearest key location</li>
                        <li>Click location names in the itinerary to quickly navigate the map to that spot</li>
                        <li>Export your trip regularly to back it up or share with travel companions</li>
                        <li>Try different map styles to see your trip in various visual contexts</li>
                        <li>Add detailed descriptions to remember why you chose each place</li>
                    </ul>

                    <div class="note" style="margin-top: 20px; padding: 15px; background: var(--bg-secondary); border-left: 4px solid var(--primary-color); border-radius: 4px;">
                        <strong>üí° Pro Tip:</strong> Start with AI generation for a complete base itinerary, then manually add, remove, or adjust locations to personalize it to your exact preferences!
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="closeInfoModal()">Got it!</button>
            </div>
        </div>
    </div>

    <!-- Location Details Modal -->
    <div id="locationDetailsModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 id="locationDetailsTitle">üìç Location Details</h2>
            </div>
            <div class="modal-body">
                <div id="locationDetailsContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="closeLocationDetailsModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- PlanPilot JS (ES6 Module) -->
    <script type="module" src="js/app.js"></script>
</body>
</html>
